{% extends 'videos/base.html' %}
{% load customtags %}
{% block content %}

<style>
  /* Page heading */
  .videos-heading{
    color:#f59e0b; /* amber */
    letter-spacing:.3px;
    font-weight:800;
  }

  /* Cards */
  .video-card{
    background:#0f141a;
    border:none;
    border-radius:16px;
    box-shadow:0 8px 24px rgba(0,0,0,.35);
    transition:transform .18s ease, box-shadow .18s ease;
    overflow:hidden;
  }
  .video-card:hover{
    transform:translateY(-2px);
    box-shadow:0 16px 40px rgba(0,0,0,.45);
  }

  /* Thumbnail */
  .thumb{
    height:200px; object-fit:cover;
    display:block;
  }

  /* Badge (views) */
  .badge-professional{
    background:rgba(245,158,11,.92); /* amber */
    color:#111;
    font-weight:700;
    border-radius:999px;
    padding:.3rem .6rem;
    font-size:.8rem;
    box-shadow:0 2px 10px rgba(245,158,11,.35);
  }

  /* Titles & text */
  .card-title a{
    color:#e5e7eb; /* light */
    text-decoration:none;
  }
  .card-title a:hover{ color:#93c5fd; } /* soft blue hover */
  .card-text{ color:#9ca3af !important; } /* muted gray */

  /* User row */
  .user-row i{ color:#60a5fa; } /* blue icon */
  .user-row a{ color:#c7d2fe; } /* light indigo username */
  .user-row a:hover{ color:#93c5fd; }

  /* Progress wrap */
  .metric-label{ color:#9ca3af; }
  .progress{
    height:6px; background:#1f2937; border-radius:999px;
  }
  .progress-bar{
    background:#10b981; /* green */
    border-radius:999px;
  }

  /* Buttons */
  .btn-outline-success, .btn-outline-danger, .btn-primary{
    border-radius:999px;
  }
  .btn-outline-success{ color:#10b981; border-color:#10b981; }
  .btn-outline-success:hover{ background:#10b981; color:#111; }
  .btn-outline-danger{ color:#ef4444; border-color:#ef4444; }
  .btn-outline-danger:hover{ background:#ef4444; color:#111; }
  .btn-primary{ background:#3b82f6; border-color:#3b82f6; }
  .btn-primary:hover{ background:#2563eb; border-color:#2563eb; }

  /* Pagination (dark) */
  .pagination .page-link{
    background:#0f141a; color:#e5e7eb; border-color:#374151;
  }
  .pagination .page-item.active .page-link{
    background:#1f2937; border-color:#f59e0b; color:#f59e0b;
  }
  .pagination .page-item.disabled .page-link{
    color:#6b7280; background:#0b0f13; border-color:#374151;
  }
</style>

<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <h2 class="mb-4 videos-heading"><i class="bi bi-play-circle"></i> Latest Videos</h2>
    </div>
  </div>

  <div class="row">
    {% for query in queryset %}
    <div class="col-lg-4 col-md-6 col-sm-12 mb-4">
      <div class="card h-100 shadow-sm video-card">

        <!-- Video Thumbnail -->
        <div class="position-relative">
          <a href="{% url 'detail' query.id %}">
            <img src="{{ query.thumbnail.url }}" class="card-img-top thumb" alt="{{ query.title }}">
          </a>
          <span class="badge-professional position-absolute top-0 end-0 m-2">
            <i class="bi bi-eye"></i> {{ query.views }}
          </span>
        </div>

        <!-- Video Info -->
        <div class="card-body d-flex flex-column">
          <h5 class="card-title mb-2">
            <a href="{% url 'detail' query.id %}">
              {{ query.title }}
            </a>
          </h5>

          <p class="card-text flex-grow-1">{{ query.description|truncatewords:15 }}</p>

          <!-- User Info -->
          <div class="d-flex align-items-center mb-2 user-row">
            <i class="bi bi-person-circle me-2"></i>
            <small>
              <a href="{% url 'user_profile' query.user.username %}">
                {{ query.user.username }}
              </a>
            </small>
          </div>

          <!-- Likes Progress Bar -->
          <div class="mb-3">
            <div class="d-flex justify-content-between align-items-center mb-1">
              <small class="metric-label">Likes</small>
              <small class="metric-label">
                {{ query.likes }}/{{ query.likes|add:query.dislikes }}
              </small>
            </div>
            <div class="progress">
              <div class="progress-bar"
                   role="progressbar"
                   style="width: {{ likes_percent|get_item:query.id }}%"
                   aria-valuenow="{{ likes_percent|get_item:query.id }}"
                   aria-valuemin="0" aria-valuemax="100">
              </div>
            </div>
          </div>

          <!-- Like/Dislike Buttons -->
          {% if user.is_authenticated %}
            <div class="btn-group w-100" role="group">
              <a href="{% url 'like_video_from_list' query.id %}"
                 class="btn {% if user_ratings|get_item:query.id == 'like' %}btn-success{% else %}btn-outline-success{% endif %} btn-sm">
                <i class="bi bi-hand-thumbs-up"></i> {{ query.likes }}
              </a>
              <a href="{% url 'dislike_video_from_list' query.id %}"
                 class="btn {% if user_ratings|get_item:query.id == 'dislike' %}btn-danger{% else %}btn-outline-danger{% endif %} btn-sm">
                <i class="bi bi-hand-thumbs-down"></i> {{ query.dislikes }}
              </a>
            </div>
          {% else %}
            <a href="{% url 'login' %}" class="btn btn-primary btn-sm w-100">
              <i class="bi bi-box-arrow-in-right"></i> Login to Rate
            </a>
          {% endif %}

        </div>
      </div>
    </div>
    {% empty %}
    <div class="col-12">
      <div class="alert alert-info text-center">
        <i class="bi bi-info-circle"></i> No videos found. Be the first to upload!
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Pagination -->
  {% if queryset.has_other_pages %}
  <div class="row mt-4">
    <div class="col-12">
      <nav aria-label="Video pagination">
        <ul class="pagination justify-content-center">
          {% if queryset.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page=1">
                <i class="bi bi-chevron-double-left"></i> First
              </a>
            </li>
            <li class="page-item">
              <a class="page-link" href="?page={{ queryset.previous_page_number }}">
                <i class="bi bi-chevron-left"></i> Previous
              </a>
            </li>
          {% else %}
            <li class="page-item disabled">
              <span class="page-link"><i class="bi bi-chevron-double-left"></i> First</span>
            </li>
            <li class="page-item disabled">
              <span class="page-link"><i class="bi bi-chevron-left"></i> Previous</span>
            </li>
          {% endif %}

          <li class="page-item active">
            <span class="page-link">
              Page {{ queryset.number }} of {{ queryset.paginator.num_pages }}
            </span>
          </li>

          {% if queryset.has_next %}
            <li class="page-item">
              <a class="page-link" href="?page={{ queryset.next_page_number }}">
                Next <i class="bi bi-chevron-right"></i>
              </a>
            </li>
            <li class="page-item">
              <a class="page-link" href="?page={{ queryset.paginator.num_pages }}">
                Last <i class="bi bi-chevron-double-right"></i>
              </a>
            </li>
          {% else %}
            <li class="page-item disabled">
              <span class="page-link">Next <i class="bi bi-chevron-right"></i></span>
            </li>
            <li class="page-item disabled">
              <span class="page-link">Last <i class="bi bi-chevron-double-right"></i></span>
            </li>
          {% endif %}
        </ul>
      </nav>
    </div>
  </div>
  {% endif %}
</div>

{% endblock %}
